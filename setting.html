<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Settings - The Little Info</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="theme-toggle.js"></script>
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <div class="header-container">
      <img src="logo.png" alt="Site Logo" class="site-logo-small" />
      <nav>
        <a href="index.html">Home</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="profile.html">Profile</a>
        <a href="#" id="logoutBtn" class="btn">Logout</a>
        <button id="themeToggle">ðŸŒ“</button>
      </nav>
    </div>
  </header>

  <!-- Settings Section -->
  <main class="section-container">
    <div class="settings-box">
      <h2 style="color: var(--primary); margin-bottom: 1rem;">User Settings</h2>

      <div class="settings-option">
        <label for="username">Change Username:</label>
        <input type="text" id="username" placeholder="Enter new username" />
      </div>

      <div class="settings-option">
        <label for="email">Update Email:</label>
        <input type="email" id="email" placeholder="Enter new email" />
      </div>

      <div class="settings-option">
        <label for="password">Change Password:</label>
        <input type="password" id="password" placeholder="Enter new password" />
      </div>

      <button class="explore-btn" id="saveSettings">Save Changes</button>
    </div>
  </main>

  <script type="module" src="setting.js"></script>
  <script type="module">
    import { auth, updateProfile, updateEmail, updatePassword } from './firebase.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';

    const usernameInput = document.getElementById('username');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const saveBtn = document.getElementById('saveSettings');

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        alert("You must be logged in to access settings.");
        window.location.href = 'login.html';
      }

      saveBtn.addEventListener('click', async () => {
        try {
          if (usernameInput.value) {
            await updateProfile(user, { displayName: usernameInput.value });
          }
          if (emailInput.value) {
            await updateEmail(user, emailInput.value);
          }
          if (passwordInput.value) {
            await updatePassword(user, passwordInput.value);
          }
          alert("Settings updated successfully!");
        } catch (error) {
          alert("Error: " + error.message);
        }
      });
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
      const { signOut } = await import('https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js');
      await signOut(auth);
      window.location.href = 'login.html';
    });
  </script>

</body>
</html>
