// analytics.js
import { getFirestore, collection, getDocs } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';

const firebaseConfig = {
  apiKey: "AIzaSyCpoq_sjH_XLdJ1ZRc0ECFaglvXh3FIS5Q",
  authDomain: "the-little-info.firebaseapp.com",
  projectId: "the-little-info",
  storageBucket: "the-little-info.appspot.com",
  messagingSenderId: "165711417682",
  appId: "1:165711417682:web:cebb205d7d5c1f18802a8b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const ctx = document.getElementById('contentChart').getContext('2d');

// Load data and render chart
async function loadAnalytics() {
  const colRef = collection(db, "content");
  const snapshot = await getDocs(colRef);

  let trending = 0;
  let traditional = 0;
  let videos = 0;
  let images = 0;

  snapshot.forEach(doc => {
    const data = doc.data();
    if (data.category === "trending") trending++;
    if (data.category === "traditional") traditional++;

    if (data.type?.startsWith("video")) videos++;
    if (data.type?.startsWith("image")) images++;
  });

  renderChart(trending, traditional, videos, images);
}

function renderChart(trending, traditional, videos, images) {
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Trending', 'Traditional', 'Videos', 'Images'],
      datasets: [{
        label: 'Content Breakdown',
        data: [trending, traditional, videos, images],
        backgroundColor: [
          '#00bcd4',
          '#ffc107',
          '#4caf50',
          '#ff5722'
        ],
        borderRadius: 8,
        hoverOffset: 10
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#333',
          titleColor: '#fff',
          bodyColor: '#ddd'
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { color: '#bbb' },
          grid: { color: '#444' }
        },
        x: {
          ticks: { color: '#bbb' },
          grid: { display: false }
        }
      }
    }
  });
}

// Run on page load
loadAnalytics();
